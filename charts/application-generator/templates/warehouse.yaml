{{- range $path, $_ := .Files.Glob "applications/*/Chart.yaml" }}
{{- $app := $.Files.Get $path | fromYaml }}
---
apiVersion: kargo.akuity.io/v1alpha1
kind: Warehouse
metadata:
  name: {{ $app.name }}
  namespace: homelab-infra
  annotations:
    lastPromotionTime: '{{ now | date "2006-01-02T15:04:05Z07:00" }}'
spec:
  subscriptions:
  - git:
      branch: main
      commitSelectionStrategy: NewestFromBranch
      discoveryLimit: 10
      repoURL: https://github.com/syoder89-homelab/homelab-infra.git
      includePaths:
      - {{ dir $path }}
      # Alternate config strategy
      #- stages/**/{{ $app.name }}-values.yaml
{{- end }}